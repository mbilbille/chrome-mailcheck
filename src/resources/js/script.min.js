/*
 *  Mailcheck for Chrome - v1.6.0.4
 *  Chrome extension to suggests a right domain when your users misspell it in an email address
 *  https://github.com/mbilbille/chrome-mailcheck
 *
 *  Made by Matthieu Bilbille
 *  Under MIT License
 */
var ChromeMailcheck=ChromeMailcheck||{};Mailcheck.defaultTopLevelDomains.push("fr"),ChromeMailcheck.options={alertType:"tooltip",displayTime:1e4,domains:Mailcheck.defaultDomains,topLevelDomains:Mailcheck.defaultTopLevelDomains,selectors:["textarea","input[type='text']","input[type='email']"],init:function(){document.addEventListener("DOMContentLoaded",ChromeMailcheck.options.load(function(){ChromeMailcheck.options.restore()})),$(document).on("blur","textarea, input",ChromeMailcheck.options.save.bind(this)),$(document).on("change","input[type='radio']",ChromeMailcheck.options.save.bind(this)),$(document).on("click","#showAdvanced",function(){$(".advanced").toggle(),$("#showAdvanced").hide(),$("#hideAdvanced").show()}),$(document).on("click","#hideAdvanced",function(){$(".advanced").toggle(),$("#hideAdvanced").hide(),$("#showAdvanced").show()}),$(document).on("click","#status .delete",function(){$("#status").html("")})},save:function(){this.domains=$("#domains").val().replace(/\s+/g,"").split(","),$("input[name='alertType']").each(function(){this.checked===!0&&(ChromeMailcheck.options.alertType=$(this).val())}),this.displayTime=1e3*$("#displayTimeNotification").val(),this.topLevelDomains=$("#topLevelDomains").val().replace(/\s+/g,"").split(","),this.selectors=$("#selectors").val().replace(/\s+/g,"").split(",");var a={domains:this.domains,alertType:this.alertType,displayTime:this.displayTime,topLevelDomains:this.topLevelDomains,selectors:this.selectors};chrome.storage.sync.set(a,function(){$("#status").html("<p class='alert'>Settings saved.</p>"),setTimeout(function(){$("#status").html("")},1e3)})},load:function(a){chrome.storage.sync.get(["domains","topLevelDomains","selectors","alertType","displayTime"],function(b){for(var c in b)ChromeMailcheck.options[c]=b[c];"function"==typeof a&&a()})},restore:function(){$("#domains").val(this.domains.join(", ")),$("#topLevelDomains").val(this.topLevelDomains.join(", ")),$("#selectors").val(this.selectors.join(", ")),$("input[name='alertType'][value='"+this.alertType+"']").attr("checked","true"),$("#displayTimeNotification").val(this.displayTime/1e3)},localize:function(){$("[i18n-content]").each(function(){$(this).html(chrome.i18n.getMessage($(this).attr("i18n-content")))})}},"options"===$("body").attr("page")&&(ChromeMailcheck.options.init(),ChromeMailcheck.options.localize());var ChromeMailcheck=ChromeMailcheck||{};ChromeMailcheck.tooltip={id:"",source:"",suggestion:{},element:null,timeout:0,flag:!1,options:{container:"body",placement:"bottom",trigger:"manual",html:"true",template:"<div class='cm-tooltip tooltip' role='tooltip'><button type='button' class='cm-close'><span>&times;</span></button><div class='cm-tooltip-arrow tooltip-arrow'></div><div class='cm-tooltip-inner tooltip-inner'></div></div>"},show:function(a,b,c){this.source=a,this.suggestion=b,$(c).tooltip($.extend({},ChromeMailcheck.tooltip.options,{title:chrome.i18n.getMessage("notifMessage",["<br /><a class='cm-link' href='#'>"+b.full+"</a>"])})),$(c).tooltip("show");var d=$(c).attr("aria-describedby");clearTimeout(this.timeout),this.timeout=window.setTimeout(function(){ChromeMailcheck.tooltip.hide(c)},ChromeMailcheck.options.displayTime),$("#"+d+" .cm-close").on("click",function(){ChromeMailcheck.tooltip.flag?ChromeMailcheck.tooltip.hide(c):ChromeMailcheck.tooltip.addDomain(c)}),$("#"+d+" a").on("click",function(a){a.preventDefault();var b=$(ChromeMailcheck.tooltip.element).val();b=b.replace(ChromeMailcheck.tooltip.source,ChromeMailcheck.tooltip.suggestion.full),$(ChromeMailcheck.tooltip.element).val(b),ChromeMailcheck.tooltip.hide(c)})},reset:function(a){var b=$(a).attr("aria-describedby");clearTimeout(this.timeout),$("#"+b).children("a").off("click")},hide:function(a){var b=$(a).attr("aria-describedby");ChromeMailcheck.tooltip.reset(a),$(a).tooltip("destroy"),$("#"+b+" .cm-close").off("click"),this.flag=!1},addDomain:function(a){var b=$(a).attr("aria-describedby"),c=ChromeMailcheck.tooltip.source.replace(/.*@/,"");ChromeMailcheck.tooltip.reset(a),$(".tooltip-inner").html(chrome.i18n.getMessage("notifAddToWhitelist",["<a class='cm-link' href='#'>"+c+"</a>"])),$("#"+b+" a").on("click",function(b){b.preventDefault(),ChromeMailcheck.options.domains.push(c),chrome.storage.sync.set({domains:ChromeMailcheck.options.domains}),ChromeMailcheck.tooltip.hide(a)}),this.flag=!0}};var ChromeMailcheck=ChromeMailcheck||{};ChromeMailcheck.extension={init:function(){ChromeMailcheck.options.load(function(){$(document).on("blur",ChromeMailcheck.options.selectors.join(","),function(){ChromeMailcheck.extension.run(this)}),$(document).on("change",ChromeMailcheck.options.selectors.join(","),function(){ChromeMailcheck.extension.reset(this)})})},run:function(a){var b=/\b([A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,6})\b/gi,c=a.value.match(b);for(var d in c)Mailcheck.run({email:c[d],domains:ChromeMailcheck.options.domains,topLevelDomains:ChromeMailcheck.options.topLevelDomains,suggested:function(b){switch(ChromeMailcheck.options.alertType){case"notification":chrome.runtime.sendMessage({type:"notification",suggestion:b,displayTime:ChromeMailcheck.options.displayTime});break;case"tooltip":ChromeMailcheck.tooltip.show(c[d],b,a)}chrome.runtime.sendMessage({type:"ga",result:"suggested"})},empty:function(){chrome.runtime.sendMessage({type:"ga",result:"empty"})}})},reset:function(a){switch(ChromeMailcheck.options.alertType){case"notification":break;case"tooltip":ChromeMailcheck.tooltip.hide(a)}}},ChromeMailcheck.extension.init();