/*
 *  Mailcheck for Chrome - v1.6.0
 *  Chrome extension to suggests a right domain when your users misspell it in an email address
 *  https://github.com/mbilbille/chrome-mailcheck
 *
 *  Made by Matthieu Bilbille
 *  Under MIT License
 */
var ChromeMailcheck=ChromeMailcheck||{};Mailcheck.defaultTopLevelDomains.push("fr"),ChromeMailcheck.options={alertType:"tooltip",domains:Mailcheck.defaultDomains,topLevelDomains:Mailcheck.defaultTopLevelDomains,selectors:["textarea","input[type='text']","input[type='email']"],init:function(){document.addEventListener("DOMContentLoaded",ChromeMailcheck.options.load(function(){ChromeMailcheck.options.restore()})),$(document).on("blur","textarea, input",ChromeMailcheck.options.save.bind(this)),$(document).on("change","input[type='radio']",ChromeMailcheck.options.save.bind(this)),$(document).on("click","#showAdvanced",function(){$(".advanced").toggle(),$("#showAdvanced").hide(),$("#hideAdvanced").show()}),$(document).on("click","#hideAdvanced",function(){$(".advanced").toggle(),$("#hideAdvanced").hide(),$("#showAdvanced").show()}),$(document).on("click","#status .delete",function(){$("#status").html("")})},save:function(){this.domains=$("#domains").val().replace(/\s+/g,"").split(","),$("input[name='alertType']").each(function(){this.checked===!0&&(ChromeMailcheck.options.alertType=$(this).val())}),this.topLevelDomains=$("#topLevelDomains").val().replace(/\s+/g,"").split(","),this.selectors=$("#selectors").val().replace(/\s+/g,"").split(",");var a={domains:this.domains,alertType:this.alertType,topLevelDomains:this.topLevelDomains,selectors:this.selectors};chrome.storage.sync.set(a,function(){$("#status").html("<p class='alert'>Settings saved.</p>"),setTimeout(function(){$("#status").html("")},1e3)})},load:function(a){chrome.storage.sync.get(["domains","topLevelDomains","selectors","alertType"],function(b){for(var c in b)ChromeMailcheck.options[c]=b[c];"function"==typeof a&&a()})},restore:function(){$("#domains").val(this.domains.join(", ")),$("#topLevelDomains").val(this.topLevelDomains.join(", ")),$("#selectors").val(this.selectors.join(", ")),$("input[name='alertType'][value='"+this.alertType+"']").attr("checked","true")},localize:function(){$("[i18n-content]").each(function(){$(this).html(chrome.i18n.getMessage($(this).attr("i18n-content")))})}},"options"===$("body").attr("page")&&(ChromeMailcheck.options.init(),ChromeMailcheck.options.localize());var ChromeMailcheck=ChromeMailcheck||{};ChromeMailcheck.tooltip={id:"",source:"",suggestion:"",element:null,timeout:0,show:function(a,b,c){this.source=a,this.suggestion=b,this.element=c,$(this.element).tooltip({title:chrome.i18n.getMessage("notifMessage",["<strong class='cm-mail'>"+b+"</strong>"]),container:"body",placement:"bottom",trigger:"manual",html:"true",template:"<div class='cm-tooltip tooltip' role='tooltip'><button type='button' class='cm-close'><span>&times;</span></button><div class='cm-tooltip-arrow tooltip-arrow'></div><div class='cm-tooltip-inner tooltip-inner'></div></div>"}),$(this.element).tooltip("show"),this.id=$(this.element).attr("aria-describedby"),this.timeout=window.setTimeout(function(){ChromeMailcheck.tooltip.hide()},7500),$("#"+this.id+" .cm-close").on("click",function(){ChromeMailcheck.tooltip.hide()}),$("#"+this.id+" .cm-mail").on("click",function(){var a=$(ChromeMailcheck.tooltip.element).val();a=a.replace(ChromeMailcheck.tooltip.source,ChromeMailcheck.tooltip.suggestion),$(ChromeMailcheck.tooltip.element).val(a),ChromeMailcheck.tooltip.hide()})},hide:function(){$(this.element).tooltip("destroy"),$(".tooltip").off("click"),$("#"+this.id).children("a").off("click"),clearTimeout(this.timeout)}};var ChromeMailcheck=ChromeMailcheck||{};ChromeMailcheck.extension={init:function(){ChromeMailcheck.options.load(function(){$(document).on("blur",ChromeMailcheck.options.selectors.join(","),function(){ChromeMailcheck.extension.run(this)})})},run:function(a){var b=/\b([A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,6})\b/gi,c=a.value.match(b);for(var d in c)Mailcheck.run({email:c[d],domains:ChromeMailcheck.options.domains,topLevelDomains:ChromeMailcheck.options.topLevelDomains,suggested:function(b){switch(ChromeMailcheck.options.alertType){case"notification":chrome.extension.sendMessage({type:"notification",suggestion:b.full});break;case"tooltip":ChromeMailcheck.tooltip.show(c[d],b.full,a)}chrome.extension.sendMessage({type:"ga",result:"suggested"})},empty:function(){chrome.extension.sendMessage({type:"ga",result:"empty"})}})}},ChromeMailcheck.extension.init();